
volatile byte rpmcount;

unsigned int rpm;

unsigned long timeold;

void setup()
{
  Serial.begin(9600);
  attachInterrupt(0, rpm_fun, FALLING);

  rpmcount = 0;
  rpm = 0;
  timeold = 0;
}

void loop()
{
  if (rpmcount >= 250) {
    //Update RPM every 20 counts, increase this for better RPM resolution,
    //decrease for faster update
    rpm = 30*1000/(millis() - timeold)*rpmcount/75;
    timeold = millis();
    rpmcount = 0;
    Serial.println(rpm,DEC);
  }
}

void rpm_fun()
{
  rpmcount++;
  //Each rotation, this interrupt function is run twice
}

